<p-toast></p-toast>
<div class="invoice-1 invoice-content">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="invoice-inner clearfix">
                    <div class="invoice-info clearfix" id="invoice_wrapper">
                        <div class="invoice-headar">
                            <div class="row g-0">
                                <div class="col-sm-6"></div>
                                <div class="col-sm-6 invoice-id">
                                    <div class="info">
                                        <h1 class="color-white inv-header-1">Nueva Orden</h1>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="invoice-top">
                            <form [formGroup]="FacturaForm" (keydown)="handleKeyDown($event)" (ngSubmit)="onSubmit()">
                                <div class="p-fluid p-formgrid grid">
                                    <div class="field col-12 md:col-6">
                                        <label for="">Cliente</label>
                                        <p-inputGroup>
                                            <p-inputGroupAddon>
                                                <i class="pi pi-user"></i>
                                            </p-inputGroupAddon>
                                            <input pInputText type="text" placeholder="Nombre" formControlName="Clie_Nombre"/>
                                        </p-inputGroup>
                                        <small *ngIf="submitted && FacturaForm.controls['Clie_Nombre'].invalid" style="color: red !important;">Nombre Requerido</small>
                                    </div>
                                    <div class="field col-12 md:col-6">
                                        <label for="">Identidad</label>
                                        <p-inputGroup>
                                            <p-inputGroupAddon>
                                                <i class="pi pi-credit-card"></i>
                                            </p-inputGroupAddon>
                                            <input pInputText type="text" placeholder="Numero de identidad" formControlName="Clie_Identidad"/>
                                        </p-inputGroup>
                                        <small *ngIf="submitted && FacturaForm.controls['Clie_Identidad'].invalid" style="color: red !important;">Identidad requerida</small>
                                    </div>
                                </div>
                                <p-table [value]="FacturaDetalle">
                                    <ng-template pTemplate="header">
                                        <tr>
                                            <th style="width:45%;">Id</th>
                                            <th style="width:45%;">Producto</th>
                                            <th style="width:10%;">Cantidad</th>
                                            <th style="width:10%;">Precio</th>
                                            <th style="width:10%;">Total</th>
                                            <th></th>
                                        </tr>
                                    </ng-template>
                                    <ng-template pTemplate="body" let-detalle>
                                        <tr>
                                            <td style="width:15%;">{{detalle.fact_Id}}</td>
                                            <td style="width:15%;">{{detalle.producto}}</td>
                                            <td style="width:15%;">{{detalle.cantidad}}</td>
                                            <td style="width:15%;">{{detalle.precio}}</td>
                                            <td style="width:15%;">{{detalle.total}}</td>
                                            <td>
                                                <button pButton pRipple icon="pi pi-times" class="p-button-rounded p-button-warning" (click)="confirmDelete(detalle)"></button>
                                            </td>
                                        </tr>
                                    </ng-template>
                                    <ng-template pTemplate="footer">
                                        <tr>
                                            <td colspan="5">
                                                <div class="radio-group">
                                                    <label>
                                                        <input type="radio" value="N" (change)="onRadioChange($event.target.value)" formControlName="FaDe_Ident" />
                                                        Complemento
                                                    </label>
                                                    <label>
                                                        <input type="radio" value="D" (change)="onRadioChange($event.target.value)" formControlName="FaDe_Ident" />
                                                        Postre
                                                    </label>
                                                    <label>
                                                        <input type="radio" value="B" (change)="onRadioChange($event.target.value)" formControlName="FaDe_Ident" />
                                                        Bebida
                                                    </label>
                                                    <label>
                                                        <input type="radio" value="P" (change)="onRadioChange($event.target.value)" formControlName="FaDe_Ident" />
                                                        Paquete
                                                    </label>
                                                </div>
                                            </td>
                                            <td style="display: flex; justify-content: flex-end; margin-top: 1rem; grid-gap: 5px;">
                                                <button pButton icon="pi pi-plus" type="button" label="Agregar" (click)="onSubmit()" class="p-button-primary"></button>
                                                <button pButton icon="pi pi-shopping-cart" type="button" label="Facturar" (click)="cancelar()" class="p-button-primary"></button>
                                            </td>
                                        </tr>
                                    </ng-template>
                                </p-table>
                                <div class="product-grid">
                                    <div class="product-card" *ngFor="let product of products">
                                        <div class="product-image">
                                            <img [src]="product.imageUrl" alt="{{product.name}}">
                                        </div>
                                        <div class="product-info">
                                            <h5>{{ product.text }}</h5>
                                            <p>Codigo: {{ product.value }}</p>
                                            <p>Precio: {{ product.precio }}</p>
                                            <div class="quantity-control">
                                                <button pButton icon="pi pi-minus" type="button" (click)="decreaseQuantity(product)"></button>
                                                <input pInputText id="FaDe_Cantidad" formControlName="FaDe_Cantidad" type="text" [(ngModel)]="product.quantity" required autofocus 
                                                [ngClass]="{'ng-invalid ng-dirty': submitted && (FacturaForm.get('FaDe_Cantidad').value === '0' || FacturaForm.get('FaDe_Cantidad').value === '')}" />
                                                <button pButton icon="pi pi-plus" type="button" (click)="increaseQuantity(product)"></button>
                                            </div>
                                            <button pButton type="button" (click)="addProductToInvoice(product)" label="AÃ±adir"></button>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.product-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    margin-top: 10px;
}
.product-card {
    border: 1px solid #ccc;
    border-radius: 8px;
    padding: 1rem;
    width: calc(25% - 1rem);
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    box-shadow: rgba(0, 0, 0, 0.4) 0px 2px 4px, rgba(0, 0, 0, 0.3) 0px 7px 13px -3px, rgba(0, 0, 0, 0.2) 0px -3px 0px inset;
}
.product-image img {
    max-width: 100%;
    height: auto;
    border-radius: 8px;
}
.product-info h5 {
    margin: 0.5rem 0;
}
.quantity-control {
    margin-left: 5px;
    display: flex;
    margin-bottom: 10px;
    align-items: center;
    gap: 0.5rem;
    margin-top: 0.5rem;
}
.quantity-control input {
    width: 50px;
    text-align: center;
}
.radio-group {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
    justify-content: flex-start;
    align-items: center;
}
.radio-group label {
    margin-right: 1rem;
    display: flex;
    align-items: center;
}
</style>
